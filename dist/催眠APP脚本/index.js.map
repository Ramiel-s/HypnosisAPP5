{"version":3,"file":"index.js","mappings":"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","sources":["src://tavern_helper_template/webpack/bootstrap","src://tavern_helper_template/webpack/runtime/compat get default export","src://tavern_helper_template/webpack/runtime/define property getters","src://tavern_helper_template/webpack/runtime/hasOwnProperty shorthand","src://tavern_helper_template/external var \"_\"","src://tavern_helper_template/src/催眠APP脚本/index.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = _;","// 催眠APP - 每日结算脚本\n// 目标：\n// 1) 当“系统.当前时间”跨天但“系统.当前日期”未更新时，自动推进日期\n// 2) 按跨越天数恢复“系统._MC能量”（每天恢复“系统._MC能量上限”的 50%）\n// 3) 每天降低“系统.主角可疑度”10点，降低每个“角色.*.警戒度”10点\n// 4) 每个角色每 5 点“警戒度”，每天会增加 1 点“主角可疑度”\n\nimport _ from 'lodash';\n\nconst UPDATE_REASON = '催眠APP脚本：每日结算';\n\nconst PATHS = {\n  system: '系统',\n  roles: '角色',\n  date: '系统.当前日期',\n  time: '系统.当前时间',\n  suspicion: '系统.主角可疑度',\n  mcEnergy: ['系统._MC能量', '系统.MC能量'],\n  mcEnergyMax: ['系统._MC能量上限', '系统.MC能量上限'],\n} as const;\n\nconst MONTH_DAYS = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31] as const;\nconst WEEKDAY_CHARS = ['一', '二', '三', '四', '五', '六', '日'] as const;\n\nfunction toFiniteNumber(val: unknown, fallback: number | null = null): number | null {\n  const n = typeof val === 'number' ? val : Number(val);\n  return Number.isFinite(n) ? n : fallback;\n}\n\nfunction clampNumber(n: number, min: number, max: number): number {\n  return Math.min(max, Math.max(min, n));\n}\n\nfunction parseTimeToMinutes(time: unknown): number | null {\n  if (typeof time !== 'string') return null;\n  const m = /^(\\d{1,2})\\s*:\\s*(\\d{1,2})(?:\\s*:\\s*(\\d{1,2}))?$/.exec(time.trim());\n  if (!m) return null;\n  const hh = Number(m[1]);\n  const mm = Number(m[2]);\n  if (!Number.isFinite(hh) || !Number.isFinite(mm)) return null;\n  if (hh < 0 || hh > 23 || mm < 0 || mm > 59) return null;\n  return hh * 60 + mm;\n}\n\ntype ParsedDate = {\n  month: number;\n  day: number;\n  weekdayIndex: number | null;\n};\n\nfunction parseDateText(text: unknown): ParsedDate | null {\n  if (typeof text !== 'string') return null;\n  const s = text.trim();\n  const dateMatch = /(\\d{1,2})\\s*月\\s*(\\d{1,2})\\s*日/.exec(s);\n  if (!dateMatch) return null;\n  const month = Number(dateMatch[1]);\n  const day = Number(dateMatch[2]);\n  if (!Number.isFinite(month) || !Number.isFinite(day)) return null;\n\n  const weekdayMatch = /(星期|周)\\s*([一二三四五六日天])/.exec(s);\n  const weekdayChar = weekdayMatch ? weekdayMatch[2] : null;\n  const normalized = weekdayChar === '天' ? '日' : weekdayChar;\n  const weekdayIndex = normalized ? WEEKDAY_CHARS.indexOf(normalized as any) : -1;\n\n  return {\n    month: clampNumber(month, 1, 12),\n    day: clampNumber(day, 1, MONTH_DAYS[clampNumber(month, 1, 12) - 1]),\n    weekdayIndex: weekdayIndex >= 0 ? weekdayIndex : null,\n  };\n}\n\nfunction toDayOfYear(d: ParsedDate): number {\n  const mIndex = clampNumber(d.month, 1, 12) - 1;\n  const dIndex = clampNumber(d.day, 1, MONTH_DAYS[mIndex]) - 1;\n  const prefix = MONTH_DAYS.slice(0, mIndex).reduce((a, b) => a + b, 0);\n  return prefix + dIndex;\n}\n\nfunction addDays(d: ParsedDate, deltaDays: number): ParsedDate {\n  let month = clampNumber(d.month, 1, 12);\n  let day = clampNumber(d.day, 1, MONTH_DAYS[month - 1]);\n  let weekdayIndex = d.weekdayIndex;\n\n  let remaining = Math.max(0, Math.floor(deltaDays));\n  while (remaining > 0) {\n    day += 1;\n    if (day > MONTH_DAYS[month - 1]) {\n      day = 1;\n      month += 1;\n      if (month > 12) month = 1;\n    }\n    if (weekdayIndex !== null) weekdayIndex = (weekdayIndex + 1) % WEEKDAY_CHARS.length;\n    remaining -= 1;\n  }\n\n  return { month, day, weekdayIndex };\n}\n\nfunction formatDateText(d: ParsedDate): string {\n  if (d.weekdayIndex === null) return `${d.month}月${d.day}日`;\n  const weekdayChar = WEEKDAY_CHARS[clampNumber(d.weekdayIndex, 0, WEEKDAY_CHARS.length - 1)];\n  return `${d.month}月${d.day}日 星期${weekdayChar}`;\n}\n\nfunction getMessageVariableOption(): VariableOption {\n  try {\n    return { type: 'message', message_id: getCurrentMessageId() };\n  } catch {\n    return { type: 'message', message_id: 'latest' };\n  }\n}\n\nasync function setIfChanged(\n  mvu: Mvu.MvuData,\n  path: string,\n  nextValue: unknown,\n  reason = UPDATE_REASON,\n): Promise<boolean> {\n  const prev = _.get(mvu.stat_data, path);\n  if (_.isEqual(prev, nextValue)) return false;\n\n  const setter = (Mvu as any).setMvuVariable as\n    | ((mvuData: Mvu.MvuData, variablePath: string, value: unknown, options?: { reason?: string }) => Promise<boolean>)\n    | undefined;\n\n  if (typeof setter === 'function') {\n    const ok = await setter(mvu, path, nextValue, { reason });\n    if (ok) _.set(mvu.stat_data, path, nextValue);\n    return ok;\n  }\n\n  _.set(mvu.stat_data, path, nextValue);\n  return true;\n}\n\nfunction pickExistingPath(statData: Record<string, any>, paths: readonly string[]): string {\n  for (const p of paths) {\n    if (_.has(statData, p)) return p;\n  }\n  return paths[0];\n}\n\nfunction resolveDayDelta(\n  beforeDate: unknown,\n  afterDate: unknown,\n  beforeTime: unknown,\n  afterTime: unknown,\n): { dayDelta: number; isDateMissingUpdate: boolean; nextDateText?: string } {\n  const beforeParsed = parseDateText(beforeDate);\n  const afterParsed = parseDateText(afterDate);\n  const beforeMinutes = parseTimeToMinutes(beforeTime);\n  const afterMinutes = parseTimeToMinutes(afterTime);\n  const timeCrossed = beforeMinutes !== null && afterMinutes !== null && afterMinutes < beforeMinutes;\n\n  if (!beforeParsed || !afterParsed) {\n    const unchanged = typeof beforeDate === 'string' && typeof afterDate === 'string' && beforeDate === afterDate;\n    const isDateMissingUpdate = unchanged && timeCrossed;\n    return { dayDelta: isDateMissingUpdate ? 1 : 0, isDateMissingUpdate };\n  }\n\n  const beforeDay = toDayOfYear(beforeParsed);\n  const afterDay = toDayOfYear(afterParsed);\n  let delta = afterDay - beforeDay;\n  if (delta < 0) delta += 365; // 允许跨年（简单按 365 天处理）\n\n  const isSameDay = delta === 0;\n  const isDateMissingUpdate = isSameDay && timeCrossed;\n  if (!isDateMissingUpdate) return { dayDelta: Math.max(0, Math.floor(delta)), isDateMissingUpdate: false };\n\n  const nextDate = addDays(afterParsed, 1);\n  return { dayDelta: 1, isDateMissingUpdate: true, nextDateText: formatDateText(nextDate) };\n}\n\nasync function applyDailySettlement(mvu: Mvu.MvuData, before: Mvu.MvuData): Promise<boolean> {\n  const statAfter = mvu.stat_data ?? {};\n  const statBefore = before?.stat_data ?? {};\n\n  const beforeDate = _.get(statBefore, PATHS.date);\n  const afterDate = _.get(statAfter, PATHS.date);\n  const beforeTime = _.get(statBefore, PATHS.time);\n  const afterTime = _.get(statAfter, PATHS.time);\n\n  const { dayDelta, isDateMissingUpdate, nextDateText } = resolveDayDelta(beforeDate, afterDate, beforeTime, afterTime);\n  if (dayDelta <= 0 && !isDateMissingUpdate) return false;\n\n  let changed = false;\n\n  if (isDateMissingUpdate && typeof nextDateText === 'string') {\n    if (await setIfChanged(mvu, PATHS.date, nextDateText)) changed = true;\n  }\n\n  const energyPath = pickExistingPath(statAfter, PATHS.mcEnergy);\n  const energyMaxPath = pickExistingPath(statAfter, PATHS.mcEnergyMax);\n  const energy = toFiniteNumber(_.get(statAfter, energyPath), 0) ?? 0;\n  const energyMax = toFiniteNumber(_.get(statAfter, energyMaxPath), null);\n\n  if (energyMax !== null) {\n    const safeMax = Math.max(0, energyMax);\n    const regenPerDay = safeMax * 0.5;\n    const nextEnergy = clampNumber(energy + regenPerDay * dayDelta, 0, safeMax);\n    if (await setIfChanged(mvu, energyPath, nextEnergy)) changed = true;\n    // 若别名字段也存在，保持一致\n    for (const aliasPath of [...PATHS.mcEnergy, ...PATHS.mcEnergyMax]) {\n      if (!_.has(statAfter, aliasPath)) continue;\n      if (aliasPath === energyPath || aliasPath === energyMaxPath) continue;\n      const aliasValue = aliasPath.includes('能量上限') ? safeMax : nextEnergy;\n      if (await setIfChanged(mvu, aliasPath, aliasValue)) changed = true;\n    }\n  }\n\n  const suspicion = toFiniteNumber(_.get(statAfter, PATHS.suspicion), null);\n  const roles = _.get(statAfter, PATHS.roles);\n  let dailySuspicionIncrease = 0;\n  if (_.isPlainObject(roles)) {\n    for (const [roleName, roleValue] of Object.entries<any>(roles)) {\n      if (!roleName) continue;\n      if (!_.isPlainObject(roleValue)) continue;\n      const alertnessPath = `${PATHS.roles}.${roleName}.警戒度`;\n      const alertness = toFiniteNumber(_.get(statAfter, alertnessPath), null);\n      if (alertness === null) continue;\n\n      // 警戒度影响可疑度：每 5 点警戒度每天 +1 可疑度（按天结算，警戒度每天还会自然下降）\n      for (let i = 0; i < dayDelta; i += 1) {\n        const alertnessAtStart = Math.max(0, alertness - 10 * i);\n        dailySuspicionIncrease += Math.floor(alertnessAtStart / 5);\n      }\n\n      const nextAlertness = Math.max(0, alertness - 10 * dayDelta);\n      if (await setIfChanged(mvu, alertnessPath, nextAlertness)) changed = true;\n    }\n  }\n\n  if (suspicion !== null) {\n    const nextSuspicion = Math.max(0, suspicion - 10 * dayDelta + dailySuspicionIncrease);\n    if (await setIfChanged(mvu, PATHS.suspicion, nextSuspicion)) changed = true;\n  }\n\n  return changed;\n}\n\n$(() => {\n  (async () => {\n    try {\n      await waitGlobalInitialized('Mvu');\n    } catch (err) {\n      console.warn('[催眠APP脚本] Mvu 未就绪，脚本不生效', err);\n      return;\n    }\n\n    let isSelfApplying = false;\n\n    eventOn(Mvu.events.VARIABLE_UPDATE_ENDED, async (after: Mvu.MvuData, before: Mvu.MvuData) => {\n      if (isSelfApplying) {\n        isSelfApplying = false;\n        return;\n      }\n\n      try {\n        const changed = await applyDailySettlement(after, before);\n        if (!changed) return;\n\n        isSelfApplying = true;\n        await Mvu.replaceMvuData(after, getMessageVariableOption());\n      } catch (err) {\n        console.error('[催眠APP脚本] 每日结算失败', err);\n        isSelfApplying = false;\n      }\n    });\n  })();\n});\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","_","PATHS","MONTH_DAYS","WEEKDAY_CHARS","toFiniteNumber","val","fallback","n","Number","isFinite","clampNumber","min","max","Math","parseTimeToMinutes","time","m","exec","trim","hh","mm","parseDateText","text","s","dateMatch","month","day","weekdayMatch","weekdayChar","normalized","weekdayIndex","indexOf","toDayOfYear","mIndex","dIndex","slice","reduce","b","formatDateText","length","async","setIfChanged","mvu","path","nextValue","reason","prev","stat_data","setter","Mvu","setMvuVariable","ok","pickExistingPath","statData","paths","p","resolveDayDelta","beforeDate","afterDate","beforeTime","afterTime","beforeParsed","afterParsed","beforeMinutes","afterMinutes","timeCrossed","isDateMissingUpdate","dayDelta","beforeDay","delta","floor","nextDateText","deltaDays","remaining","addDays","$","waitGlobalInitialized","err","console","warn","isSelfApplying","eventOn","events","VARIABLE_UPDATE_ENDED","after","before","changed","statAfter","statBefore","energyPath","energyMaxPath","energy","energyMax","safeMax","nextEnergy","aliasPath","aliasValue","includes","suspicion","roles","dailySuspicionIncrease","roleName","roleValue","entries","alertnessPath","alertness","i","alertnessAtStart","nextAlertness","nextSuspicion","applyDailySettlement","replaceMvuData","type","message_id","getCurrentMessageId","getMessageVariableOption","error"],"ignoreList":[],"sourceRoot":""}