{"version":3,"file":"index.js","mappings":"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J,CACER,MAAO,QACPC,OAAQ,EACRG,MAAO,qCACPC,KAAM,+DACNG,OAAQ,CACN,mBACA,+CACA,2BACA,+BACA,uCAGJ,CACER,MAAO,QACPC,OAAQ,EACRG,MAAO,yBACPC,KAAM,mEACNG,OAAQ,CACN,mDACA,yCACA,kCACA,QACA,gCAGJ,CACER,MAAO,QACPC,OAAQ,EACRG,MAAO,yCACPC,KAAM,4OACNG,OAAQ,CACN,WACA,+DACA,+BACA,uEACA,mEACA,wCACA,4BACA,oCACA,kDACA,qBAIN,MAAO,CACL,CACER,MAAO,QACPC,OAAQ,EACRG,MAAO,2BACPC,KAAM,6IACNG,OAAQ,CACN,2CACA,6BACA,qDACA,yBACA,qDAGJ,CACER,MAAO,QACPC,OAAQ,EACRG,MAAO,qBACPC,KAAM,0LACNG,OAAQ,CACN,KACA,+BACA,0CACA,oDACA,2CACA,qCAGJ,CACER,MAAO,QACPC,OAAQ,EACRG,MAAO,kBACPC,KAAM,uJACNG,OAAQ,CACN,0BACA,sCACA,wDACA,2BACA,4CACA,oBAGJ,CACER,MAAO,QACPC,OAAQ,EACRG,MAAO,iCACPC,KAAM,4PACNG,OAAQ,CACN,aACA,sCACA,gDACA,2BACA,+CACA,uCAIN,MAAO,CACL,CACER,MAAO,QACPC,OAAQ,EACRG,MAAO,2BACPC,KAAM,mSACNG,OAAQ,CACN,mCACA,oDACA,qCACA,gCACA,mCAGJ,CACER,MAAO,QACPC,OAAQ,EACRG,MAAO,wCACPC,KAAM,wVACNG,OAAQ,CACN,kBACA,mCACA,6BACA,mCACA,uCAGJ,CACER,MAAO,QACPC,OAAQ,EACRG,MAAO,6BACPC,KAAM,ySACNG,OAAQ,CACN,uBACA,0BACA,wCACA,0BACA,6CAGJ,CACER,MAAO,QACPC,OAAQ,EACRG,MAAO,mBACPC,KAAM,wSACNG,OAAQ,CACN,iBACA,6CACA,qBACA,6BACA,4BAGJ,CACER,MAAO,QACPC,OAAQ,EACRG,MAAO,qBACPC,KAAM,uGACNG,OAAQ,CACN,iBACA,2CACA,OACA,kCAIN,IAAK,CACH,CACER,MAAO,MACPC,OAAQ,EACRG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","sources":["src://tavern_helper_template/node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_fcc8164c33ab268660e3819796c9f485/node_modules/vue-loader/dist/exportHelper.js","src://tavern_helper_template/webpack/bootstrap","src://tavern_helper_template/external var \"Vue\"","src://tavern_helper_template/src/MChan/core/mchan.ts","webpack://tavern_helper_template/./src/MChan/ui/App.vue?8a67","webpack://tavern_helper_template/src/MChan/ui/App.vue?336c","src://tavern_helper_template/src/MChan/index.ts"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n// runtime helper for setting properties on components\n// in a tree-shakable way\nexports.default = (sfc, props) => {\n    const target = sfc.__vccOpts || sfc;\n    for (const [key, val] of props) {\n        target[key] = val;\n    }\n    return target;\n};\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","const __WEBPACK_NAMESPACE_OBJECT__ = Vue;","export const BOARD_NAMES = ['公告区', '新手引导区', '综合讨论区', '成果展示区', '求助区'] as const;\nexport type BoardName = (typeof BOARD_NAMES)[number];\n\nexport type FloorSource = 'ai' | 'user' | 'local';\n\nexport type Floor = {\n  floorNo: number;\n  content: string;\n  createdAtMs: number;\n  source: FloorSource;\n  originKey?: string; // e.g. \"msg:123:floor:0\"\n  originFloorTagNo?: number;\n};\n\nexport type Post = {\n  board: BoardName;\n  postNo: number;\n  title: string;\n  body: string;\n  createdAtMs: number;\n  updatedAtMs: number;\n  floors: Floor[];\n};\n\nexport type MChanStateV1 = {\n  version: 1;\n  boards: Record<BoardName, { posts: Post[] }>;\n  meta: {\n    lastParsedAssistantMessageId?: number;\n  };\n};\n\nexport function createEmptyState(): MChanStateV1 {\n  return {\n    version: 1,\n    boards: {\n      公告区: { posts: [] },\n      新手引导区: { posts: [] },\n      综合讨论区: { posts: [] },\n      成果展示区: { posts: [] },\n      求助区: { posts: [] },\n    },\n    meta: {},\n  };\n}\n\nfunction safeNowMs(): number {\n  return Date.now();\n}\n\nfunction getChatScopedKey(): string {\n  try {\n    const chatId = (window as any)?.SillyTavern?.getCurrentChatId?.();\n    if (chatId !== undefined && chatId !== null && String(chatId).length > 0) {\n      return String(chatId);\n    }\n  } catch {}\n  return 'global';\n}\n\nexport function getStorageKey(): string {\n  return `mchan.v1:${getChatScopedKey()}`;\n}\n\nfunction safeJsonParse(text: string): unknown {\n  try {\n    return JSON.parse(text);\n  } catch {\n    return undefined;\n  }\n}\n\nfunction isBoardName(value: unknown): value is BoardName {\n  return typeof value === 'string' && (BOARD_NAMES as readonly string[]).includes(value);\n}\n\nexport function loadState(): MChanStateV1 {\n  const raw = localStorage.getItem(getStorageKey());\n  if (!raw) return createEmptyState();\n\n  const parsed = safeJsonParse(raw);\n  if (!parsed || typeof parsed !== 'object') return createEmptyState();\n\n  // Best-effort validation + forward-compat fallback.\n  const v = (parsed as any).version;\n  if (v !== 1) return createEmptyState();\n\n  const state = createEmptyState();\n  const boards = (parsed as any).boards;\n  if (boards && typeof boards === 'object') {\n    for (const boardName of BOARD_NAMES) {\n      const b = (boards as any)[boardName];\n      if (!b || typeof b !== 'object' || !Array.isArray((b as any).posts)) continue;\n      state.boards[boardName].posts = (b as any).posts\n        .filter((p: any) => p && typeof p === 'object')\n        .map((p: any) => {\n          const board = isBoardName(p.board) ? p.board : boardName;\n          const postNo = Number.isFinite(p.postNo) ? Number(p.postNo) : 1;\n          const title = typeof p.title === 'string' ? p.title : `帖子${postNo}`;\n          const body = typeof p.body === 'string' ? p.body : '';\n          const createdAtMs = Number.isFinite(p.createdAtMs) ? Number(p.createdAtMs) : safeNowMs();\n          const updatedAtMs = Number.isFinite(p.updatedAtMs) ? Number(p.updatedAtMs) : createdAtMs;\n          const floors = Array.isArray(p.floors)\n            ? p.floors\n                .filter((f: any) => f && typeof f === 'object')\n                .map((f: any) => ({\n                  floorNo: Number.isFinite(f.floorNo) ? Number(f.floorNo) : 1,\n                  content: typeof f.content === 'string' ? f.content : '',\n                  createdAtMs: Number.isFinite(f.createdAtMs) ? Number(f.createdAtMs) : safeNowMs(),\n                  source: (f.source === 'ai' || f.source === 'user' || f.source === 'local') ? f.source : 'local',\n                  originKey: typeof f.originKey === 'string' ? f.originKey : undefined,\n                  originFloorTagNo: Number.isFinite(f.originFloorTagNo) ? Number(f.originFloorTagNo) : undefined,\n                }))\n            : [];\n          floors.sort((a, b) => a.floorNo - b.floorNo);\n          return { board, postNo, title, body, createdAtMs, updatedAtMs, floors } satisfies Post;\n        });\n      state.boards[boardName].posts.sort((a, b) => a.postNo - b.postNo);\n    }\n  }\n\n  const meta = (parsed as any).meta;\n  if (meta && typeof meta === 'object') {\n    const last = (meta as any).lastParsedAssistantMessageId;\n    if (Number.isFinite(last)) state.meta.lastParsedAssistantMessageId = Number(last);\n  }\n\n  return state;\n}\n\nexport function saveState(state: MChanStateV1): void {\n  localStorage.setItem(getStorageKey(), JSON.stringify(state));\n}\n\nexport function getBoardPosts(state: MChanStateV1, board: BoardName): Post[] {\n  return state.boards[board].posts;\n}\n\nexport function getNextPostNo(state: MChanStateV1, board: BoardName): number {\n  const posts = getBoardPosts(state, board);\n  const max = posts.reduce((m, p) => Math.max(m, p.postNo), 0);\n  return max + 1;\n}\n\nexport function getNextFloorNo(post: Post): number {\n  const max = post.floors.reduce((m, f) => Math.max(m, f.floorNo), 0);\n  return max + 1;\n}\n\nexport function upsertPost(\n  state: MChanStateV1,\n  board: BoardName,\n  postNo: number,\n  patch?: Partial<Pick<Post, 'title' | 'body'>>,\n): Post {\n  const posts = state.boards[board].posts;\n  let post = posts.find(p => p.postNo === postNo);\n  if (!post) {\n    const now = safeNowMs();\n    post = {\n      board,\n      postNo,\n      title: patch?.title ?? `${board} 帖子${postNo}`,\n      body: patch?.body ?? '',\n      createdAtMs: now,\n      updatedAtMs: now,\n      floors: [],\n    };\n    posts.push(post);\n    posts.sort((a, b) => a.postNo - b.postNo);\n  } else if (patch) {\n    if (typeof patch.title === 'string' && patch.title.trim().length > 0) post.title = patch.title.trim();\n    if (typeof patch.body === 'string' && patch.body.trim().length > 0) post.body = patch.body.trim();\n    post.updatedAtMs = safeNowMs();\n  }\n  return post;\n}\n\nexport function appendFloor(post: Post, floor: Omit<Floor, 'floorNo'> & { floorNo?: number }): Floor {\n  const next = getNextFloorNo(post);\n  const desired = floor.floorNo;\n  const floorNo = typeof desired === 'number' && desired === next ? desired : next;\n  const full: Floor = { ...floor, floorNo };\n  post.floors.push(full);\n  post.floors.sort((a, b) => a.floorNo - b.floorNo);\n  post.updatedAtMs = safeNowMs();\n  return full;\n}\n\nexport type ParsedPostBlock = {\n  board: BoardName;\n  postNo: number;\n  title?: string;\n  body?: string;\n  floors: Array<{ floorTagNo?: number; content: string }>;\n};\n\nfunction escapeRegexLiteral(text: string): string {\n  return text.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n}\n\nfunction normalizeContent(text: string): string {\n  return text.replace(/\\r\\n/g, '\\n').trim();\n}\n\nexport function parseTaggedBlocks(text: string): ParsedPostBlock[] {\n  const normalized = normalizeContent(text);\n  if (!normalized) return [];\n\n  const boardsPattern = BOARD_NAMES.map(escapeRegexLiteral).join('|');\n  const outerRe = new RegExp(\n    `<(?<tag>(?:${boardsPattern})帖子\\\\d+)>(?<inner>[\\\\s\\\\S]*?)<\\\\/\\\\k<tag>>`,\n    'gu',\n  );\n\n  const blocks: ParsedPostBlock[] = [];\n  for (const m of normalized.matchAll(outerRe)) {\n    const tag = m.groups?.tag ?? '';\n    const inner = m.groups?.inner ?? '';\n    const tagMatch = tag.match(new RegExp(`^(?<board>${boardsPattern})帖子(?<no>\\\\d+)$`, 'u'));\n    const board = tagMatch?.groups?.board;\n    const no = tagMatch?.groups?.no;\n    if (!board || !no || !isBoardName(board)) continue;\n    const postNo = Number.parseInt(no, 10);\n    if (!Number.isFinite(postNo) || postNo <= 0) continue;\n\n    const title = inner.match(/<标题>([\\s\\S]*?)<\\/标题>/u)?.[1];\n    const body = inner.match(/<正文>([\\s\\S]*?)<\\/正文>/u)?.[1];\n\n    const floorRe = /<(?<ftag>楼层\\d+)>(?<finner>[\\s\\S]*?)<\\/\\k<ftag>>/gu;\n    const floors: Array<{ floorTagNo?: number; content: string }> = [];\n    for (const fm of inner.matchAll(floorRe)) {\n      const ftag = fm.groups?.ftag ?? '';\n      const finner = fm.groups?.finner ?? '';\n      const n = ftag.match(/^楼层(\\d+)$/u)?.[1];\n      const floorTagNo = n ? Number.parseInt(n, 10) : undefined;\n      const content = normalizeContent(finner);\n      if (!content) continue;\n      floors.push({ floorTagNo, content });\n    }\n\n    // Allow \"new post\" blocks even if floors are missing.\n    blocks.push({\n      board,\n      postNo,\n      title: title ? normalizeContent(title) : undefined,\n      body: body ? normalizeContent(body) : undefined,\n      floors,\n    });\n  }\n  return blocks;\n}\n\nexport function applyParsedBlocks(\n  state: MChanStateV1,\n  blocks: ParsedPostBlock[],\n  source: FloorSource,\n  originMessageId?: number,\n): { createdPosts: number; appendedFloors: number } {\n  let createdPosts = 0;\n  let appendedFloors = 0;\n\n  blocks.forEach((b, bIdx) => {\n    const existed = state.boards[b.board].posts.some(p => p.postNo === b.postNo);\n    const post = upsertPost(state, b.board, b.postNo, {\n      title: b.title,\n      body: b.body,\n    });\n    if (!existed) createdPosts += 1;\n\n    b.floors.forEach((f, fIdx) => {\n      const originKey = originMessageId !== undefined ? `msg:${originMessageId}:post:${b.board}:${b.postNo}:floor:${bIdx}:${fIdx}` : undefined;\n      if (originKey && post.floors.some(x => x.originKey === originKey)) {\n        return;\n      }\n      appendFloor(post, {\n        content: f.content,\n        createdAtMs: safeNowMs(),\n        source,\n        originKey,\n        originFloorTagNo: f.floorTagNo,\n      });\n      appendedFloors += 1;\n    });\n  });\n\n  if (originMessageId !== undefined) {\n    state.meta.lastParsedAssistantMessageId = Math.max(state.meta.lastParsedAssistantMessageId ?? -1, originMessageId);\n  }\n\n  return { createdPosts, appendedFloors };\n}\n\nexport type ReplyPromptArgs = {\n  board: BoardName;\n  postNo: number;\n  lastFloorNo: number;\n  floorsToGenerate?: number;\n  userInstruction?: string;\n};\n\nexport function buildReplyPrompt(args: ReplyPromptArgs): string {\n  const floorsToGenerate = 6;\n  const start = args.lastFloorNo + 1;\n  const end = start + floorsToGenerate - 1;\n  const tag = `${args.board}帖子${args.postNo}`;\n\n  const instruction = (args.userInstruction ?? '').trim();\n\n  return [\n    `{{user}}正在为浏览匿名版「${args.board}」的帖子 ${args.postNo} 你需要生成回复楼层。`,\n    `当前最后楼层是 ${args.lastFloorNo}。请生成 ${floorsToGenerate} 个新楼层（楼层号从 ${start} 到 ${end}）。`,\n    instruction ? `用户补充要求：${instruction}` : '',\n    `必须严格只输出以下 HTML 标签并用<匿名版></匿名版>包裹结构：`,\n    `- 不要输出任何额外文字`,\n    `- 不要输出 Markdown 代码块/反引号`,\n    `<${tag}>`,\n    ...Array.from({ length: floorsToGenerate }, (_, i) => {\n      const n = start + i;\n      return `<楼层${n}>（在这里写楼层内容）</楼层${n}>`;\n    }),\n    `</${tag}>`,\n  ]\n    .filter(Boolean)\n    .join('\\n');\n}\n\nexport type PostContextForPrompt = {\n  board: BoardName;\n  postNo: number;\n  title: string;\n  body: string;\n  floors: Array<Pick<Floor, 'floorNo' | 'content'>>;\n};\n\nfunction escapeForTagContent(text: string): string {\n  return text.replace(/[<>]/g, m => (m === '<' ? '＜' : '＞'));\n}\n\nfunction buildTaggedContextBlock(post: PostContextForPrompt, opts?: { maxFloors?: number }): { block: string; truncated: boolean } {\n  const maxFloors = Math.max(1, opts?.maxFloors ?? 30);\n  const floors = post.floors;\n  const truncated = floors.length > maxFloors;\n  const selected = truncated ? floors.slice(Math.max(0, floors.length - maxFloors)) : floors;\n\n  const tag = `${post.board}帖子${post.postNo}`;\n  const lines = [\n    `<${tag}>`,\n    `<标题>${escapeForTagContent(post.title)}</标题>`,\n    `<正文>${escapeForTagContent(post.body)}</正文>`,\n    ...selected.map(f => `<楼层${f.floorNo}>${escapeForTagContent(f.content)}</楼层${f.floorNo}>`),\n    `</${tag}>`,\n  ];\n  return { block: lines.join('\\n'), truncated };\n}\n\nexport type FollowupPromptArgs = {\n  post: PostContextForPrompt;\n  // The user's reply has already been appended to the post.\n  lastFloorNo: number;\n  aiFloorsToGenerate: number;\n  aiStyleHint?: string;\n};\n\nexport function buildAiFollowupPrompt(args: FollowupPromptArgs): string {\n  const aiFloorsToGenerate = 6;\n  const start = args.lastFloorNo + 1;\n  const end = start + aiFloorsToGenerate - 1;\n  const tag = `${args.post.board}帖子${args.post.postNo}`;\n\n  const { block, truncated } = buildTaggedContextBlock(args.post, { maxFloors: 30 });\n  const styleHint = (args.aiStyleHint ?? '').trim();\n\n  return [\n    `{{user}}刚发布了匿名版「${args.post.board}」的一个串，你需要模仿其他匿名用户继续回复。`,\n    `你要生成 ${aiFloorsToGenerate} 个新楼层（楼层号从 ${start} 到 ${end}）。`,\n    styleHint ? `额外要求：${styleHint}` : '',\n    `引用（帖子标题/正文/已有楼层，作为上文与格式示例）：`,\n    truncated ? `（上文已截断：仅包含最近30楼）` : '',\n    block,\n    `输出要求：`,\n    `- 必须严格只输出以下 HTML 标签并用<匿名版></匿名版>包裹结构`,\n    `- 不要输出任何额外文字/解释`,\n    `- 不要输出 Markdown 代码块/反引号`,\n    `- 楼层内容中避免出现 < 或 >（如必须使用请改用全角＜＞）`,\n    `- 回复要像真实匿名版：可以短句、口语、偶尔用 >>No.楼层号 引用`,\n    `<${tag}>`,\n    ...Array.from({ length: aiFloorsToGenerate }, (_, i) => {\n      const n = start + i;\n      return `<楼层${n}>（以匿名用户口吻写内容）</楼层${n}>`;\n    }),\n    `</${tag}>`,\n  ]\n    .filter(Boolean)\n    .join('\\n');\n}\n\nexport type NewPostPromptArgs = {\n  board: BoardName;\n  postNo: number;\n  userInstruction?: string;\n};\n\nexport function buildNewPostPrompt(args: NewPostPromptArgs): string {\n  const tag = `${args.board}帖子${args.postNo}`;\n  const instruction = (args.userInstruction ?? '').trim();\n\n  return [\n    `{{user}}正在为匿名版「${args.board}」创建一个新帖子，帖子序号必须是 ${args.postNo}（不要改序号）。`,\n    instruction ? `用户补充要求：${instruction}` : '',\n    `必须严格只输出以下 HTML 标签并用<匿名版></匿名版>包裹结构：`,\n    `- 不要输出任何额外文字`,\n    `- 不要输出 Markdown 代码块/反引号`,\n    `- 正文/楼层内容中避免出现 < 或 >（如必须使用请改用全角＜＞）`,\n    `<${tag}>`,\n    `<标题>（在这里写标题）</标题>`,\n    `<正文>（在这里写正文）</正文>`,\n    `<楼层1>（在这里写首楼内容）</楼层1>`,\n    `</${tag}>`,\n  ]\n    .filter(Boolean)\n    .join('\\n');\n}\n\nfunction slashQuote(text: string): string {\n  // Ensure we don't accidentally split the slash command line.\n  const escaped = text.replace(/\\\\/g, '\\\\\\\\').replace(/\"/g, '\\\\\"').replace(/\\r?\\n/g, '\\\\n');\n  return `\"${escaped}\"`;\n}\n\nexport async function sendPromptToTavern(prompt: string): Promise<void> {\n  // Prefer slash pipeline so the prompt is visibly placed into Tavern input before sending.\n  try {\n    await triggerSlash(`/setinput ${slashQuote(prompt)} | /send | /trigger`);\n    return;\n  } catch {}\n\n  // Fallback: best-effort fill input, then send reliably via createChatMessages.\n  try {\n    await triggerSlash(`/setinput ${slashQuote(prompt)}`);\n  } catch {\n    // Ignore.\n  }\n  await createChatMessages([{ role: 'user', message: prompt }]);\n  await triggerSlash('/trigger');\n}\n\nexport type Preset = Record<BoardName, Array<Omit<Post, 'floors' | 'createdAtMs' | 'updatedAtMs'> & { floors?: string[] }>>;\n\nexport const DEFAULT_PRESET: Preset = {\n  公告区: [\n    {\n      board: '公告区',\n      postNo: 1,\n      title: '置顶：匿名版守则（简版）',\n      body: '这里是自建匿名版。请勿泄露现实身份信息；匿名版内一切内容均为角色扮演/故事设定。',\n      floors: ['欢迎使用。本匿名版为催眠APP使用者自行搭建, 跟官方无关, 也不负责售后。'],\n    },\n    {\n      board: '公告区',\n      postNo: 2,\n      title: '【警示】最近在涩谷有人当众使用催眠APP被发现, 人被警察带走了, 大家注意低调',\n      body: '如题，为了避免引起注意，请大家避免在公众场合被目击使用明显的催眠。',\n      floors: ['真是蠢货，要是害得警方注意到了那就麻烦了。'],\n    },\n  ],\n  新手引导区: [\n    {\n      board: '新手引导区',\n      postNo: 1,\n      title: '[急] 手机太老了, 后台开了几个app后再用催眠APP, 手机现在烫得吓人, 会影响功能吗？',\n      body: '刚下载APP，想试试效果。结果刚开始催眠，手机背面烫得能煎鸡蛋，APP还特别卡。这种情况下还能正常催眠吗？能不能贴模板脸上增强效果顺便散热。在线等，挺急的。',\n      floors: [\n        '楼主你什么机型？建议外挂个散热背夹，这APP优化极差，不仅吃内存还烧CPU。',\n        '贴脸上物理降温草，你这是要把目标烫醒吗？',\n        '别硬撑，万一电池炸了，你就直接把人脸给炸了',\n        '建议杀后台软件，还卡就老老实实换手机吧。',\n      ],\n    },\n    {\n      board: '新手引导区',\n      postNo: 2,\n      title: '[疑问] 目标重度近视, 5米之外人畜不分那种, 会影响催眠效果吗？',\n      body: '我在图书馆对一个眼镜娘用了基础催眠，平时只要对视3秒就晕了。但她刚好在擦眼镜，看了半天好像没什么反应，虽然也没认出我来。难道近视还能防催眠？',\n      floors: [\n        '笑死，近视反催眠。',\n        '如果近视到看不清屏幕的话, 大概会影响吧',\n        '这种情况下还是等她带上眼镜吧',\n        '也有可能只是你催眠指令太模糊了, 催眠了也没发现.',\n        '这就是为什么我在平板上也装了这个app，大屏幕专门对付近视娘。',\n      ],\n    },\n    {\n      board: '新手引导区',\n      postNo: 3,\n      title: '[系统] 安装APP时提示要开启“麦克风”和“定位”权限，这安全吗？',\n      body: '为什么催眠APP也要这么多权限啊！这APP要这么多权限，会不会偷听我说话或者把我的位置发给网警？有没有懂哥分析一下代码？',\n      floors: [\n        '楼主你用催眠APP了，还怕网警？',\n        '麦克风是为了采集你的声纹生成“命令音频”，定位是为了扫描附近的“可攻略素体”，别想多了。',\n        '你要是怕，就搞个备用机，不插卡只连公共WiFi。',\n        '最大的安全隐患是你操作失误被目标报警，而不是APP本身。',\n        '放心吧，开发这APP的组织都有这种黑科技了，想要你那点隐私还不简单?',\n      ],\n    },\n    {\n      board: '新手引导区',\n      postNo: 4,\n      title: '[新人] 初始任务送的点数怎么花性价比最高？',\n      body: '刚注册初始任务送了一点点数，功能里琳琅满目不知道买啥。是买点数上限还是解锁新功能”？我想走纯爱路线（指让对方以为我是她男朋友）。',\n      floors: [\n        '别买时间停止！别买时间停止！新人MC能量不够, 只能停几分钟，脱个裤子都来不及，除非你是快枪手.',\n        '纯爱流必须点“常识修改”，这是核心技能。先把“陌生人判定”改成“熟人判定”。',\n        '解锁敏感度修改或者发情吧, 先让目标高潮获得MC点, 循环起来',\n        '楼上说得对',\n        '新人听我一句劝，先买“记忆消除”，万一玩脱了还能跑路。',\n      ],\n    },\n    {\n      board: '新手引导区',\n      postNo: 5,\n      title: '[社死] 以为断开投屏了，结果在百寸大屏上启动了APP，老板问那个螺旋是什么',\n      body: '如题。刚才季度汇报，讲完PPT后投屏没关。由于太无聊，手贱想解锁个新功能结果点错了。\\n\\n结果那个巨大的、粉紫色的、高对比度的螺旋就在100寸幕布上转了起来。\\n音响还非常尽职尽责地最大音量播报了：『催眠APP, 启动』。\\n\\n全场死寂了大概5秒。\\n现在老板、HR、还有隔壁组的那个大胸女经理都在看着我，眼神很奇怪。\\n我现在躲在楼道抽烟，手在抖。\\n\\n有没有一种可能，投影仪流明够高，完成了群体催眠？\\n我是不是可以直接命令老板给我涨薪了？在线等，挺急的。',\n      floors: [\n        '没救了，重开吧。',\n        '>>1 楼主醒醒。投影仪只负责投影影像，就算有效果估计也会失真。除非你老板贴在幕布上看，否则他们现在只是觉得你是个变态。',\n        '笑死，这就是传说中的全屏AOE吗？但是没过判定啊wwww',\n        '快！趁现在还没断开连接，马上播放『常识置换』的音频！把设定改成『这是公司最新的视觉系企业文化宣传片』！只要你信念够强，说不定能蒙混过关！',\n        '『催眠APP, 启动』... 笑死, 喜欢自定义启动音效是吧。建议楼主直接说是中了病毒，或者说这是测试部开发的什么奇怪Demo。',\n        '如果那个女经理脸红了，说明她可能潜意识抗性低，楼主不要放弃，单独找她试试。',\n        '悲报：楼主十分钟没回话了，估计已经被保安叉出去了。',\n        'RIP。下辈子记得先检查投屏开关，或者别在公司用这种APP啊白痴。',\n        '有没有后续？如果老板也被催眠了，是不是可以直接把公司变成这种APP的线下据点？想想都有点带感。',\n        '>>9 醒醒，你当这是H漫吗？',\n      ],\n    },\n  ],\n  综合讨论区: [\n    {\n      board: '综合讨论区',\n      postNo: 1,\n      title: '【悲报】最新版本的耗电量也太异常了，手机发烫严重',\n      body: '只是开启了十分钟的「常识重构」模式，我的Xperia简直烫得能煎鸡蛋。\\n\\n明明说明书上写着使用的是“不可听声波”，但这发热量怎么看都是在满负荷运行吧？\\n刚才差点就在目标面前露馅了，因为她碰到我的手时候问我为什么拿着个暖宝宝。\\n\\n如果不解决散热问题，夏天根本没法用啊。',\n      floors: [\n        '>>1 这里的常识是：高性能=高发热。想控制那个精密的大脑，这点代价是必须的吧。',\n        '我都贴着退烧用的冷却贴在手机背面用的，建议你也试试。',\n        '比起这个，把常识改成“手机发烫是因为里面寄宿着热情的精灵”不就好了？反正平然化之后她也不会觉得奇怪。',\n        '>>3 天才。但这甚至比原来的借口更可疑吧w',\n        '不要用索尼，换个散热好的游戏手机吧。虽然拿着那种RGB光污染严重的手机去催眠有点破坏气氛就是了。',\n      ],\n    },\n    {\n      board: '综合讨论区',\n      postNo: 2,\n      title: '关于范围催眠在早高峰电车上的测试报告',\n      body: '坐标山手线。\\n今早试着开启了范围模式，设定内容是：「电车摇晃时大声喊出“喵”是礼貌行为」。\\n\\n效果非常惊人，但也非常精神污染。\\n\\n一个大叔失去平衡时喊了一声野太的“喵！”，周围的OL和学生完全没有惊讶，甚至有个jk点头示意，觉得大叔很有教养。\\n最可怕的是，哪怕没有完全站稳的人，为了不被当成没礼貌的家伙，也会特意晃动一下然后叫一声。\\n\\n这就是地狱吗？',\n      floors: [\n        '草。',\n        '>>1 你是恶魔吗？想象了一下那个画面，咖啡喷了一屏幕。',\n        '平然化机制太强了。如果不设定“遗忘”，下车后他们会记得自己像猫一样叫了一路吗？',\n        '>>3 只要没设定“离开范围失效”，这种常识改变会持续一段时间吧。估计到了公司也会对着上司喵喵叫。',\n        '这已经属于社会实验了吧。下次试试把常识改成“必须像相扑力士一样张开腿站立”看看。',\n        '我也想试试，但我这边的乡下电车根本不挤，完全没有触发条件（哭）。',\n      ],\n    },\n    {\n      board: '综合讨论区',\n      postNo: 3,\n      title: '如果不小心照到了镜子会怎么样？',\n      body: '刚才在洗手间测试，屏幕亮度开到了最大。\\n不小心通过镜子的反射和屏幕对视了大概3秒。\\n\\nAPP说明上好像没写有“使用者保护机制”，但我现在感觉有点奇怪。\\n总觉得“必须要给这层楼的每个人买布丁”是一种宇宙真理。\\n\\n我现在手里提着20个布丁站在便利店门口。\\n这是BUG吗？还是我单纯饿了？',\n      floors: [\n        '>>1 恭喜，你中招了。把自己给催眠了www。',\n        '快点对自己使用“解除”或者“重置”音频！在那个奇怪的常识根深蒂固之前！',\n        '来不及了，如果是高强度的常识改变，>>1 现在的潜意识已经在合理化这个行为了。“买布丁是人类生存的义务”。',\n        '把布丁寄给我，我帮你解除催眠。地址是东京都...',\n        '别听楼上的。只要你没把APP给扔了，稍微睡一觉，那是短期暗示，过几个小时就失效了。',\n        '这就是所谓的“自爆”吧，笨蛋w',\n      ],\n    },\n    {\n      board: '综合讨论区',\n      postNo: 4,\n      title: '那个...我想把常识改成「全裸待机是正常的」，结果出大问题了',\n      body: '对象是借住在我家的青梅竹马。\\n我看她眼神涣散，以为成功了，结果这APP的判定是不是有点过于严谨？\\n\\n她现在确实觉得全裸是正常的，像呼吸一样自然。\\n在客厅看电视、做饭都一丝不挂，完全没有羞耻心，甚至还问我为什么在家里还要穿衣服。\\n\\n问题是：她对我完全没有那方面的意思。\\n\\n哪怕她光着身子坐在我旁边，态度也和平时一样冷淡，依然在吐槽我打游戏太菜。\\n甚至因为“裸体很正常”，我盯着看反而会被说“你这家伙盯着别人的皮肤看什么，恶心”。\\n\\n这和我想象的桃色展开完全不一样啊！怎么会这样！',\n      floors: [\n        '>>1 可怜的家伙w',\n        '这是当然的吧。你只改变了“关于衣服的常识”，又没改变“对你的好感度”。',\n        '这就叫“色即是空”。因为全裸变得理所当然了，所以在她眼里你看到的裸体就和看到脸没什么区别。',\n        '反而更兴奋了怎么办。这种平然的日常感才是最棒的。',\n        '建议追加设定：「虽然裸体很正常，但皮肤接触是打招呼的方式」。一步一步来嘛，楼主太心急了。',\n        '>>1 这种由于常识改变带来的“无防备感”才是精髓啊，你还太甜了。',\n      ],\n    },\n  ],\n  成果展示区: [\n    {\n      board: '成果展示区',\n      postNo: 1,\n      title: '【免费】试着把深夜的便利店变成了“某种服务场所”',\n      body: '既然是深夜班，稍微玩大一点也没关系吧？\\n\\n使用了范围催眠，针对那个总是戴着耳机爱理不理的打工妹。\\n设定常识：「结账时，为了表示对客人的感谢，必须让客人确认内裤的颜色」。\\n\\n【视频附件：00:45】\\n画面为便利店收银台监控视角（带噪点）。一名身穿制服的年轻女店员在扫描商品条形码的同时，左手极其自然地掀起后侧裙摆，暴露出白蓝条纹的棉质内裤。在做出“请确认金额”的手势时，她特意向柜台外侧转身并微微翘起臀部以展示胯下。柜台前的中年男性顾客面无表情地注视着这一部位长达五秒，随后平静地掏出钱包付款。女店员放下裙摆，继续进行装袋动作，表情从头到尾保持着无精打采的营业状态。',\n      floors: [\n        '这就是传说中的“杀必死”吗？那个冷漠的表情配上这种动作简直极品。',\n        '>>1 这种平然的感觉太棒了。她完全没意识到自己在做什么变态的事情，只是把它当成工作流程的一部分w',\n        '我也想去这家店。请务必把常识追加为“如果是会员，可以触摸确认质地”。',\n        '后面的大叔也太淡定了吧，这就是那个什么“认知阻碍”的效果？',\n        '>>4 是常识改变啦。在大叔眼里这就和看着店员装袋一样自然。',\n      ],\n    },\n    {\n      board: '成果展示区',\n      postNo: 2,\n      title: '【10MC】既然是名门高中的大小姐，那肯定也是名门的“肉便器”吧？（多图）',\n      body: '捕捉到了野生的学生会长。\\n虽然平时总是一副看垃圾的眼神看着我们，但只要稍微修改一下大脑里的字典...\\n\\n设定：「虽然是高贵的大小姐，但生理构造是公用的」。\\n\\n【图片集附件：共15张】\\n[Image 01-03] 场景为学生会室。一名黑长直发女生坐在红木办公桌上，双手端着骨瓷茶杯优雅饮茶，下半身裙装褪至脚踝，双腿向两侧极大张开呈M字型展示私处，视角正对镜头。\\n[Image 04-08] 体育器材室背景。画面模糊，显示一名身穿运动服的中年男性正从后方对该女生进行插入行为。女生脸部特写显示其表情高傲冷淡，眼神直视前方，带有某种履行义务般的庄严感。\\n[Image 09] 走廊过道。学生会室的大门紧闭，门把手上挂着一块木制牌子，用流利的书法写着：『公用肉壶 使用中』。',\n      floors: [\n        '神。MC点已付，请务必搞快点。',\n        '这种反差感真是让人受不了。明明姿势那么下流，气质却还是那么高贵。',\n        '>>1 真的假的，那个大小姐？楼主小心别被特定的啊w',\n        '这就是APP的可怕之处吗...连羞耻心都被重新定义为“荣耀”了。',\n        '不管看多少次，这种被常识束缚导致无法反抗的样子还是最能激发征服欲啊。',\n      ],\n    },\n    {\n      board: '成果展示区',\n      postNo: 3,\n      title: '【免费/悲报】我不小心把“常识”的范围设定错了...',\n      body: '本来想让女友觉得“在家不穿内衣很正常”。\\n结果没注意开启了【区域广播模式】。\\n\\n现在好了，我妈、我姐，还有刚才来送快递的大妈，全部都是真空上阵。\\n\\n【视频附件：00:15】\\n手持摄像机拍摄的家庭客厅场景。镜头扫过沙发，一名50岁左右的女性身穿宽松白色T恤，胸部位置有明显的激凸和下垂轮廓，动作间衣领敞开可见大片肌肤。画面快速切向开放式厨房，年轻女性背对镜头切菜，身上仅穿着一件粉色围裙，侧面视角确认围裙下没有任何衣物，系带直接勒进裸露的背部肉中。视频末尾，玄关门打开，一名穿着快递公司制服马甲的中年女性走进屋内，马甲拉链未拉，随着走动可以看到松弛的乳房在敞开的制服下大幅晃动。',\n      floors: [\n        '>>1 住手！这是天堂啊！绝对不要解除！',\n        '这就是所谓的“意外之喜”吗？快递大妈就免了吧w',\n        '羡慕死我了。既然都是一家人，下一步把“乱伦”的常识也修正一下不就完美了吗？',\n        '>>1 请务必让我去你家做客，我不介意热一点。',\n        '笨蛋楼主，这种时候应该顺水推舟，把常识改为“互相检查身体是增进家庭和睦的方式”。',\n      ],\n    },\n    {\n      board: '成果展示区',\n      postNo: 4,\n      title: '【5MC】让偶像团体握手变握屌会',\n      body: '买了那个地下偶像团体的握手券。\\n偷偷把常识修改成了：「握手会其实是“握屌会”，粉丝把那东西拿出来是应援的一种方式」。\\n\\n【视频附件：03:20】\\n偶像握手会现场全景。长桌后站着五名身穿亮片演出服的年轻偶像。桌子对面的粉丝列队中，男性粉丝纷纷拉下裤链，将生殖器搁置在铺有桌布的长桌面上。C位偶像保持着标准的露齿笑容，并未看向粉丝脸部，而是直接伸出双手握住面前粉丝的阴茎，进行幅度约为5厘米的上下摇晃动作，嘴唇开合似乎在说着“谢谢支持”。背景处身穿『STAFF』字样T恤的工作人员正用扩音器对排队人群进行引导，并没有对暴露行为进行阻拦，反而指着挂在墙上的“严禁射精”告示牌进行提醒。',\n      floors: [\n        '我要吐了，也是字面意义上的。',\n        '>>1 虽然很恶心，但Staff也在维护秩序这个点戳中笑点了。这就是平然化的恐怖吗。',\n        '买了。想看有没有粉丝真在现场发射的。',\n        '这种虽然没有H行为但充满了疯狂气息的视频才是最棒的。',\n        '下次试试把常识改成“必须用嘴叼着门票入场”吧。',\n      ],\n    },\n    {\n      board: '成果展示区',\n      postNo: 6,\n      title: '【悬赏】想看到“排泄”常识逆转的场景',\n      body: '我想把看到把常识改成：「上厕所是一件非常羞耻、必须在大庭广众之下被人围观才能做的事」，而「在大街上漏出来反而是卫生的」。\\n\\n但是自己的能量不够\\n有没有能够实现这个场景的。\\n悬赏 30 MC点。',\n      floors: [\n        '楼主口味真重...但我喜欢。',\n        '>>1 是需要露天排泄吗, 但平然感太强好像有点没意思, 要不要加个羞耻心反转?',\n        '楼上天才',\n        '期待成果视频。还有，请务必加上“完事后要求表扬”的设定。',\n      ],\n    },\n  ],\n  求助区: [\n    {\n      board: '求助区',\n      postNo: 1,\n      title: '【急】目标陷入了逻辑死循环，正在疯狂发热',\n      body: '对象是图书委员长，性格比较死板的那种。\\n我给她植入了「绝对服从APP持有者」的命令，但忘记删除她原本「绝对遵守校规」的强烈潜意识。\\n\\n刚才我命令她「在图书馆大声叫春」，结果她整个人僵住了。\\n眼神在涣散和清醒之间以极高的频率切换，嘴里一直重复着“叫...不...叫...不...”。\\n\\n最可怕的是她头顶真的在冒烟啊！摸了一下额头烫得吓人。\\n这会不会把大脑烧坏？我现在无论说什么她都没反应了。',\n      floors: [\n        '>>1 典型的逻辑冲突。这种认真型的妹子最麻烦了。',\n        '就像给电脑同时输入两个相反指令一样，CPU过热了w',\n        '快点用“强制关机”音频！就是那个长按音量键+电源键触发的紧急模式！www',\n        '如果烧坏了也挺好的，变成只会流口水的废人娃娃，玩法更多（笑）。',\n        '>>1 别听楼上的，那是不可逆损伤。赶紧带去保健室，然后用物理降温（指冰袋，不是你的那话儿）。',\n      ],\n    },\n    {\n      board: '求助区',\n      postNo: 2,\n      title: '误操作结果被物理反杀了',\n      body: '目标是拳击社的主将。\\n我想着只要让她看一眼屏幕就赢了，于是假装去问路。\\n\\n结果这APP启动的时候闪光灯闪了一下（好像是我误触了）。\\n她下意识一个右勾拳直接轰在我脸上。\\n\\n醒来的时候在医院，手机碎成了渣。\\n医生说我鼻梁骨断了。\\n这种情况APP开发商管赔吗？',\n      floors: [\n        '>>1 赔个屁w 自己操作失误怪谁。',\n        '谁让你去惹格斗系的，那种人的反射神经比视觉处理速度还快。',\n        '手机碎了数据备份了吗？要是账号丢了那才是真悲剧。',\n        '惨。不过换个角度想，你现在有了“被她打伤”的借口，可以去勒索...啊不，去以此为借口接近她了。',\n        '楼上天才。这才是正统的本子开局啊！“如果不听话我就去起诉你伤害罪”。',\n      ],\n    },\n    {\n      board: '求助区',\n      postNo: 3,\n      title: '这也太离谱了，目标的“精神抗性”也太高了吧？',\n      body: '试图对那个很有名的辣妹系使用常识重构。\\n设定是「不知羞耻的露出狂」。\\n\\n进度条明明显示100%完成了。\\n结果她只是皱了皱眉，说了一句：“哈？这种程度的内衣外穿现在很流行吧？土包子。”\\n\\n然后就若无其事地继续玩手机了。\\n我想让她脱光，她反而嘲笑我：“想看？给钱啊。你是穷鬼吗？”\\n\\n完全没有被催眠的那种呆滞感，反而把我的命令合理化成了她的原有性格。\\n这是失败了吗？',\n      floors: [\n        '不是失败，是“兼容性过高”导致的同化现象。',\n        '>>1 说明她本来潜意识里就挺荡的，你的催眠只是给了她一个放飞自我的借口。',\n        '这种情况反而更难搞，因为她觉得自己是清醒的。建议加大剂量，或者直接改用“人格排泄”模式。',\n        '辣妹系的防御力本来就是谜。有时候看似只是碧池，其实内心防线坚不可摧；有时候看似纯情，其实一戳就破。',\n        '试试给钱？说不定会有意外收获。反正之后可以用“遗忘”把钱拿回来。',\n      ],\n    },\n    {\n      board: '求助区',\n      postNo: 4,\n      title: '救命，我不小心把自己手机的音频输出孔给堵住了',\n      body: '为了防止误触，我一直用胶带贴着扬声器。\\n结果刚才想用“声波催眠”模式对付那个一直在睡觉的同桌。\\n\\nAPP显示“发送中”，但因为声音出不去，好像导致手机内部元件过热，触发了某种短路。\\n现在手机屏幕变成了诡异的漩涡状图案，而且关不掉！\\n\\n最糟糕的是，我盯着屏幕看了一会儿想修好它，现在感觉眼皮好沉...\\n总觉得“把手机吃下去”似乎是个不错的修理方法...\\n\\n我是不是要完了？打字好困...',\n      floors: [\n        '>>1 喂！别看屏幕！把手机扔远点！',\n        '这是一个楼主即将变成这楼里第一个牺牲者的现场吗？',\n        '笑死，这种低级错误。声波反射回震把自己给催眠了？',\n        '>>1 还在吗？如果你还在，请回复“汪”一声。',\n        '大概已经在吃手机了吧。南无。希望没有设定什么“变成性奴”之类的催眠吧。',\n      ],\n    },\n    {\n      board: '求助区',\n      postNo: 5,\n      title: '关于把目标玩坏后的售后处理',\n      body: '一时兴起，给隔壁的人妻设定了「每走一步就会高潮一次」的常识。\\n我想着看她走路摇摇晃晃的样子一定很有趣。\\n\\n结果忘了设定“仅限五分钟”的时间限制。\\n她去买菜的路上走了两千步...\\n\\n现在她瘫在路边口吐白沫，翻着白眼抽搐，救护车都来了。\\n由于常识还在，她在担架上只要被震动一下就会发出一声巨大的娇喘，急救人员都看傻了。\\n\\n这种情况下我该怎么混进去解除催眠？如果你是医生，你会让一个路人靠近患者吗？',\n      floors: [\n        '>>1 你是个罪人w 但干得漂亮。',\n        '这就是玩脱了的典型。那种强度的快感会把神经烧断的。',\n        '别去解除了，现在去肯定会被当成可疑分子抓起来。',\n        '等她到了医院，你也装病混进去吧。或者用远程声波试试？虽然医院嘈杂环境效果不好。',\n        '估计醒来后大脑会开启自我保护机制把这段记忆封锁吧...大概。或者变成真正的废人。',\n      ],\n    },\n  ],\n};\n\nexport function addPreset(state: MChanStateV1, preset: Preset, mode: 'append' | 'overwrite'): void {\n  const now = safeNowMs();\n  for (const board of BOARD_NAMES) {\n    if (mode === 'overwrite') {\n      state.boards[board].posts = [];\n    }\n    for (const p of preset[board]) {\n      if (state.boards[board].posts.some(x => x.postNo === p.postNo)) continue;\n      const post: Post = {\n        board,\n        postNo: p.postNo,\n        title: p.title,\n        body: p.body,\n        createdAtMs: now,\n        updatedAtMs: now,\n        floors: [],\n      };\n      (p.floors ?? []).forEach((content, idx) => {\n        post.floors.push({\n          floorNo: idx + 1,\n          content,\n          createdAtMs: now,\n          source: 'local',\n        });\n      });\n      state.boards[board].posts.push(post);\n    }\n    state.boards[board].posts.sort((a, b) => a.postNo - b.postNo);\n  }\n}\n","import { defineComponent as _defineComponent } from 'vue';\nimport { createElementVNode as _createElementVNode, unref as _unref, toDisplayString as _toDisplayString, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, normalizeClass as _normalizeClass, isRef as _isRef, vModelText as _vModelText, withDirectives as _withDirectives, createTextVNode as _createTextVNode, createStaticVNode as _createStaticVNode } from \"vue\";\nconst _hoisted_1 = { class: \"bbs\" };\nconst _hoisted_2 = { class: \"bbs__header\" };\nconst _hoisted_3 = {\n    key: 0,\n    class: \"bbs__status\"\n};\nconst _hoisted_4 = { class: \"bbs__actions\" };\nconst _hoisted_5 = {\n    class: \"bbs__nav\",\n    \"aria-label\": \"boards\"\n};\nconst _hoisted_6 = [\"onClick\"];\nconst _hoisted_7 = { class: \"bbs__navText\" };\nconst _hoisted_8 = { class: \"bbs__navCount\" };\nconst _hoisted_9 = {\n    key: 0,\n    class: \"bbs__tools\"\n};\nconst _hoisted_10 = { class: \"bbs__toolsBody\" };\nconst _hoisted_11 = { class: \"bbs__field\" };\nconst _hoisted_12 = [\"value\"];\nconst _hoisted_13 = { class: \"bbs__field\" };\nconst _hoisted_14 = { class: \"bbs__row\" };\nconst _hoisted_15 = {\n    class: \"bbs__main\",\n    \"aria-label\": \"content\"\n};\nconst _hoisted_16 = {\n    key: 0,\n    class: \"bbs__board\"\n};\nconst _hoisted_17 = { class: \"bbs__boardTop\" };\nconst _hoisted_18 = { class: \"bbs__boardTitle\" };\nconst _hoisted_19 = {\n    key: 0,\n    class: \"bbs__empty\"\n};\nconst _hoisted_20 = [\"onClick\"];\nconst _hoisted_21 = { class: \"bbs__colNo\" };\nconst _hoisted_22 = { class: \"bbs__colSubj\" };\nconst _hoisted_23 = { class: \"bbs__subject\" };\nconst _hoisted_24 = {\n    key: 0,\n    class: \"bbs__snippet\"\n};\nconst _hoisted_25 = { class: \"bbs__colR\" };\nconst _hoisted_26 = { class: \"bbs__colUpd\" };\nconst _hoisted_27 = {\n    key: 1,\n    class: \"bbs__thread\"\n};\nconst _hoisted_28 = { class: \"bbs__threadTop\" };\nconst _hoisted_29 = { class: \"bbs__crumb\" };\nconst _hoisted_30 = { class: \"bbs__crumbBoard\" };\nconst _hoisted_31 = { class: \"bbs__mono\" };\nconst _hoisted_32 = {\n    key: 0,\n    class: \"bbs__op\"\n};\nconst _hoisted_33 = { class: \"bbs__opHead\" };\nconst _hoisted_34 = { class: \"bbs__subject\" };\nconst _hoisted_35 = { class: \"bbs__meta\" };\nconst _hoisted_36 = {\n    key: 0,\n    class: \"bbs__opBody\"\n};\nconst _hoisted_37 = {\n    key: 1,\n    class: \"bbs__replies\"\n};\nconst _hoisted_38 = {\n    key: 0,\n    class: \"bbs__empty\"\n};\nconst _hoisted_39 = { class: \"bbs__replyHead\" };\nconst _hoisted_40 = { class: \"bbs__replyNo\" };\nconst _hoisted_41 = { class: \"bbs__replyMeta\" };\nconst _hoisted_42 = [\"onClick\"];\nconst _hoisted_43 = { class: \"bbs__replyBody\" };\nconst _hoisted_44 = {\n    key: 2,\n    class: \"bbs__composer\"\n};\nconst _hoisted_45 = {\n    key: 0,\n    class: \"bbs__hint\"\n};\nconst _hoisted_46 = { class: \"bbs__mono\" };\nconst _hoisted_47 = { class: \"bbs__field\" };\nconst _hoisted_48 = { class: \"bbs__field\" };\nconst _hoisted_49 = { class: \"bbs__row\" };\nconst _hoisted_50 = {\n    key: 2,\n    class: \"bbs__newThread\"\n};\nconst _hoisted_51 = { class: \"bbs__threadTop\" };\nconst _hoisted_52 = { class: \"bbs__crumb\" };\nconst _hoisted_53 = { class: \"bbs__crumbBoard\" };\nconst _hoisted_54 = { class: \"bbs__composer\" };\nconst _hoisted_55 = { class: \"bbs__field\" };\nconst _hoisted_56 = { class: \"bbs__field\" };\nconst _hoisted_57 = { class: \"bbs__row\" };\nimport { BOARD_NAMES, DEFAULT_PRESET, applyParsedBlocks, appendFloor, buildAiFollowupPrompt, buildNewPostPrompt, getBoardPosts, getNextFloorNo, getNextPostNo, loadState, parseTaggedBlocks, saveState, sendPromptToTavern, } from '../core/mchan';\n\nimport { ref, computed, watch, nextTick, onMounted } from 'vue';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'App',\n    setup(__props) {\n        const selectedBoard = ref('综合讨论区');\n        const view = ref({ mode: 'board' });\n        const state = ref(loadState());\n        const toolsOpen = ref(false);\n        const syncStatus = ref('');\n        const posts = computed(() => getBoardPosts(state.value, selectedBoard.value));\n        const thread = computed(() => {\n            if (view.value.mode !== 'thread')\n                return undefined;\n            return state.value.boards[view.value.board].posts.find(p => p.postNo === view.value.postNo);\n        });\n        function postKey(p) {\n            return `${p.board}:${p.postNo}`;\n        }\n        function selectBoard(b) {\n            selectedBoard.value = b;\n            view.value = { mode: 'board' };\n        }\n        function openThread(board, postNo) {\n            view.value = { mode: 'thread', board, postNo };\n        }\n        function toggleTools() {\n            toolsOpen.value = !toolsOpen.value;\n        }\n        let saveTimer;\n        function scheduleSave() {\n            if (saveTimer)\n                window.clearTimeout(saveTimer);\n            saveTimer = window.setTimeout(() => {\n                saveState(state.value);\n            }, 200);\n        }\n        watch(state, scheduleSave, { deep: true });\n        function ensurePresetPostsExist() {\n            let added = 0;\n            for (const board of BOARD_NAMES) {\n                for (const p of DEFAULT_PRESET[board]) {\n                    if (state.value.boards[board].posts.some(x => x.postNo === p.postNo))\n                        continue;\n                    const now = Date.now();\n                    state.value.boards[board].posts.push({\n                        board,\n                        postNo: p.postNo,\n                        title: p.title,\n                        body: p.body,\n                        createdAtMs: now,\n                        updatedAtMs: now,\n                        floors: (p.floors ?? []).map((content, idx) => ({\n                            floorNo: idx + 1,\n                            content,\n                            createdAtMs: now,\n                            source: 'local',\n                        })),\n                    });\n                    added += 1;\n                }\n                state.value.boards[board].posts.sort((a, b) => a.postNo - b.postNo);\n            }\n            if (added > 0)\n                scheduleSave();\n        }\n        function parseThisFloorTags() {\n            const messageId = getCurrentMessageId();\n            const msg = getChatMessages(messageId)[0];\n            if (!msg)\n                return;\n            const blocks = parseTaggedBlocks(msg.message);\n            if (blocks.length === 0)\n                return;\n            const { createdPosts, appendedFloors } = applyParsedBlocks(state.value, blocks, 'ai', messageId);\n            if (createdPosts > 0 || appendedFloors > 0) {\n                scheduleSave();\n                syncStatus.value = `synced +${createdPosts} threads, +${appendedFloors} replies`;\n            }\n        }\n        function parseAssistantMessage(messageId) {\n            const msg = getChatMessages(messageId)[0];\n            if (!msg || msg.role !== 'assistant')\n                return;\n            const blocks = parseTaggedBlocks(msg.message);\n            if (blocks.length === 0)\n                return;\n            const { createdPosts, appendedFloors } = applyParsedBlocks(state.value, blocks, 'ai', messageId);\n            if (createdPosts > 0 || appendedFloors > 0) {\n                scheduleSave();\n                syncStatus.value = `synced +${createdPosts} threads, +${appendedFloors} replies`;\n            }\n        }\n        function formatTime(ms) {\n            const d = new Date(ms);\n            const yyyy = d.getFullYear();\n            const mm = String(d.getMonth() + 1).padStart(2, '0');\n            const dd = String(d.getDate()).padStart(2, '0');\n            const hh = String(d.getHours()).padStart(2, '0');\n            const mi = String(d.getMinutes()).padStart(2, '0');\n            return `${yyyy}-${mm}-${dd} ${hh}:${mi}`;\n        }\n        const replyText = ref('');\n        const replyAiHint = ref('');\n        const replyToFloorNo = ref(null);\n        const replyTextareaEl = ref(null);\n        function beginReplyTo(floorNo) {\n            replyToFloorNo.value = floorNo;\n            const prefix = `>>No.${floorNo}\\n`;\n            if (!replyText.value.startsWith(prefix))\n                replyText.value = prefix + replyText.value;\n            nextTick(() => {\n                replyTextareaEl.value?.focus();\n            });\n        }\n        function clearReplyTo() {\n            replyToFloorNo.value = null;\n        }\n        async function sendReplyAndLetAiFollow(p) {\n            let content = replyText.value.trim();\n            if (!content) {\n                toastr.warning('请先输入你的回帖内容');\n                return;\n            }\n            if (replyToFloorNo.value !== null && !content.includes(`>>No.${replyToFloorNo.value}`)) {\n                content = `>>No.${replyToFloorNo.value}\\n${content}`;\n            }\n            appendFloor(p, {\n                content,\n                createdAtMs: Date.now(),\n                source: 'user',\n                originKey: `user:${Date.now()}`,\n            });\n            scheduleSave();\n            const lastFloorNo = getNextFloorNo(p) - 1;\n            const prompt = buildAiFollowupPrompt({\n                post: {\n                    board: p.board,\n                    postNo: p.postNo,\n                    title: p.title,\n                    body: p.body,\n                    floors: p.floors.map(f => ({ floorNo: f.floorNo, content: f.content })),\n                },\n                lastFloorNo,\n                aiFloorsToGenerate: 1,\n                aiStyleHint: replyAiHint.value,\n            });\n            await sendPromptToTavern(prompt);\n            replyText.value = '';\n            replyToFloorNo.value = null;\n        }\n        const newThreadTitle = ref('');\n        const newThreadBody = ref('');\n        async function requestAiNewThread() {\n            const board = selectedBoard.value;\n            const postNo = getNextPostNo(state.value, board);\n            const prompt = buildNewPostPrompt({\n                board,\n                postNo,\n                userInstruction: `请在该板块生成一个新的真实匿名版帖子（口吻像 2ch/4chan），标题要像用户自拟的主题，正文与首楼要有具体内容。`,\n            });\n            await sendPromptToTavern(prompt);\n        }\n        async function sendNewThreadPrompt() {\n            const board = selectedBoard.value;\n            const postNo = getNextPostNo(state.value, board);\n            const title = newThreadTitle.value.trim();\n            const body = newThreadBody.value.trim();\n            if (!title) {\n                toastr.warning('请先输入标题');\n                return;\n            }\n            const now = Date.now();\n            const post = { board, postNo, title, body, createdAtMs: now, updatedAtMs: now, floors: [] };\n            state.value.boards[board].posts.push(post);\n            state.value.boards[board].posts.sort((a, b) => a.postNo - b.postNo);\n            scheduleSave();\n            view.value = { mode: 'thread', board, postNo };\n            const prompt = buildAiFollowupPrompt({\n                post: { board, postNo, title, body, floors: [] },\n                lastFloorNo: 0,\n                aiFloorsToGenerate: 1,\n                aiStyleHint: '请直接回应OP正文内容，不要生成新帖。',\n            });\n            await sendPromptToTavern(prompt);\n            clearNewThread();\n        }\n        function clearNewThread() {\n            newThreadTitle.value = '';\n            newThreadBody.value = '';\n        }\n        const exportJson = computed(() => JSON.stringify(state.value, null, 2));\n        const importJson = ref('');\n        function doImport() {\n            const ok = window.confirm('确定导入并覆盖当前匿名版数据？');\n            if (!ok)\n                return;\n            try {\n                const next = JSON.parse(importJson.value);\n                if (!next || typeof next !== 'object' || next.version !== 1) {\n                    toastr.error('导入失败：JSON格式不正确或版本不匹配');\n                    return;\n                }\n                state.value = next;\n                scheduleSave();\n                toastr.success('导入成功');\n            }\n            catch {\n                toastr.error('导入失败：无法解析JSON');\n            }\n        }\n        onMounted(() => {\n            ensurePresetPostsExist();\n            parseThisFloorTags();\n            const myId = getCurrentMessageId();\n            eventOn(tavern_events.MESSAGE_UPDATED, messageId => {\n                if (Number(messageId) !== myId)\n                    return;\n                parseThisFloorTags();\n            });\n            eventOn(tavern_events.MESSAGE_SWIPED, messageId => {\n                if (Number(messageId) !== myId)\n                    return;\n                parseThisFloorTags();\n            });\n            eventOn(tavern_events.GENERATION_ENDED, messageId => {\n                parseAssistantMessage(Number(messageId));\n            });\n            eventOn(tavern_events.CHAT_CHANGED, () => {\n                window.location.reload();\n            });\n        });\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n                _createElementVNode(\"header\", _hoisted_2, [\n                    _cache[17] || (_cache[17] = _createElementVNode(\"div\", { class: \"bbs__brand\" }, [\n                        _createElementVNode(\"span\", { class: \"bbs__logo\" }, \"MChan\"),\n                        _createElementVNode(\"span\", { class: \"bbs__sep\" }, \"/\"),\n                        _createElementVNode(\"span\", { class: \"bbs__tagline\" }, \"anonymous board\")\n                    ], -1 /* CACHED */)),\n                    (_unref(syncStatus))\n                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_3, _toDisplayString(_unref(syncStatus)), 1 /* TEXT */))\n                        : _createCommentVNode(\"v-if\", true),\n                    _createElementVNode(\"div\", _hoisted_4, [\n                        _createElementVNode(\"button\", {\n                            class: \"bbs__link\",\n                            type: \"button\",\n                            onClick: _cache[0] || (_cache[0] = ($event) => (toggleTools()))\n                        }, _toDisplayString(_unref(toolsOpen) ? '关闭工具' : '工具'), 1 /* TEXT */)\n                    ])\n                ]),\n                _createElementVNode(\"nav\", _hoisted_5, [\n                    (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(BOARD_NAMES), (b) => {\n                        return (_openBlock(), _createElementBlock(\"button\", {\n                            key: b,\n                            type: \"button\",\n                            class: _normalizeClass([\"bbs__navItem\", { 'bbs__navItem--active': _unref(selectedBoard) === b }]),\n                            onClick: ($event) => (selectBoard(b))\n                        }, [\n                            _createElementVNode(\"span\", _hoisted_7, _toDisplayString(b), 1 /* TEXT */),\n                            _createElementVNode(\"span\", _hoisted_8, \"(\" + _toDisplayString(_unref(state).boards[b].posts.length) + \")\", 1 /* TEXT */)\n                        ], 10 /* CLASS, PROPS */, _hoisted_6));\n                    }), 128 /* KEYED_FRAGMENT */))\n                ]),\n                (_unref(toolsOpen))\n                    ? (_openBlock(), _createElementBlock(\"section\", _hoisted_9, [\n                        _createElementVNode(\"details\", null, [\n                            _cache[20] || (_cache[20] = _createElementVNode(\"summary\", null, \"导入/导出（localStorage）\", -1 /* CACHED */)),\n                            _createElementVNode(\"div\", _hoisted_10, [\n                                _createElementVNode(\"div\", _hoisted_11, [\n                                    _cache[18] || (_cache[18] = _createElementVNode(\"div\", { class: \"bbs__label\" }, \"导出\", -1 /* CACHED */)),\n                                    _createElementVNode(\"textarea\", {\n                                        class: \"bbs__textarea\",\n                                        rows: \"6\",\n                                        readonly: \"\",\n                                        value: _unref(exportJson)\n                                    }, null, 8 /* PROPS */, _hoisted_12)\n                                ]),\n                                _createElementVNode(\"div\", _hoisted_13, [\n                                    _cache[19] || (_cache[19] = _createElementVNode(\"div\", { class: \"bbs__label\" }, \"导入（会覆盖当前数据）\", -1 /* CACHED */)),\n                                    _withDirectives(_createElementVNode(\"textarea\", {\n                                        \"onUpdate:modelValue\": _cache[1] || (_cache[1] = ($event) => (_isRef(importJson) ? (importJson).value = $event : null)),\n                                        class: \"bbs__textarea\",\n                                        rows: \"5\"\n                                    }, null, 512 /* NEED_PATCH */), [\n                                        [_vModelText, _unref(importJson)]\n                                    ]),\n                                    _createElementVNode(\"div\", _hoisted_14, [\n                                        _createElementVNode(\"button\", {\n                                            class: \"bbs__btn bbs__btn--danger\",\n                                            type: \"button\",\n                                            onClick: _cache[2] || (_cache[2] = ($event) => (doImport()))\n                                        }, \"导入并覆盖\"),\n                                        _createElementVNode(\"button\", {\n                                            class: \"bbs__btn\",\n                                            type: \"button\",\n                                            onClick: _cache[3] || (_cache[3] = ($event) => (importJson.value = ''))\n                                        }, \"清空\")\n                                    ])\n                                ])\n                            ])\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                _createElementVNode(\"main\", _hoisted_15, [\n                    (_unref(view).mode === 'board')\n                        ? (_openBlock(), _createElementBlock(\"section\", _hoisted_16, [\n                            _createElementVNode(\"div\", _hoisted_17, [\n                                _createElementVNode(\"div\", _hoisted_18, _toDisplayString(_unref(selectedBoard)), 1 /* TEXT */),\n                                _createElementVNode(\"button\", {\n                                    class: \"bbs__btn bbs__btn--primary\",\n                                    type: \"button\",\n                                    onClick: _cache[4] || (_cache[4] = ($event) => (requestAiNewThread()))\n                                }, \"刷新\"),\n                                _createElementVNode(\"button\", {\n                                    class: \"bbs__btn\",\n                                    type: \"button\",\n                                    onClick: _cache[5] || (_cache[5] = ($event) => (view.value = { mode: 'newThread' }))\n                                }, \"发新串\")\n                            ]),\n                            _cache[21] || (_cache[21] = _createStaticVNode(\"<div class=\\\"bbs__listHead\\\" data-v-594d1231><span class=\\\"bbs__colNo\\\" data-v-594d1231>No</span><span class=\\\"bbs__colSubj\\\" data-v-594d1231>Subject</span><span class=\\\"bbs__colR\\\" data-v-594d1231>R</span><span class=\\\"bbs__colUpd\\\" data-v-594d1231>Updated</span></div>\", 1)),\n                            (_unref(posts).length === 0)\n                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_19, \"暂无帖子（预制帖子会在代码层面提供；此板块当前为空）。\"))\n                                : _createCommentVNode(\"v-if\", true),\n                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(posts), (p) => {\n                                return (_openBlock(), _createElementBlock(\"button\", {\n                                    key: postKey(p),\n                                    type: \"button\",\n                                    class: \"bbs__rowItem\",\n                                    onClick: ($event) => (openThread(p.board, p.postNo))\n                                }, [\n                                    _createElementVNode(\"span\", _hoisted_21, \"#\" + _toDisplayString(p.postNo), 1 /* TEXT */),\n                                    _createElementVNode(\"span\", _hoisted_22, [\n                                        _createElementVNode(\"span\", _hoisted_23, _toDisplayString(p.title), 1 /* TEXT */),\n                                        (p.body)\n                                            ? (_openBlock(), _createElementBlock(\"span\", _hoisted_24, _toDisplayString(p.body), 1 /* TEXT */))\n                                            : _createCommentVNode(\"v-if\", true)\n                                    ]),\n                                    _createElementVNode(\"span\", _hoisted_25, _toDisplayString(p.floors.length), 1 /* TEXT */),\n                                    _createElementVNode(\"span\", _hoisted_26, _toDisplayString(formatTime(p.updatedAtMs)), 1 /* TEXT */)\n                                ], 8 /* PROPS */, _hoisted_20));\n                            }), 128 /* KEYED_FRAGMENT */))\n                        ]))\n                        : (_unref(view).mode === 'thread')\n                            ? (_openBlock(), _createElementBlock(\"section\", _hoisted_27, [\n                                _createElementVNode(\"div\", _hoisted_28, [\n                                    _createElementVNode(\"button\", {\n                                        class: \"bbs__link\",\n                                        type: \"button\",\n                                        onClick: _cache[6] || (_cache[6] = ($event) => (view.value = { mode: 'board' }))\n                                    }, \"← 返回\"),\n                                    _createElementVNode(\"div\", _hoisted_29, [\n                                        _createElementVNode(\"span\", _hoisted_30, _toDisplayString(_unref(view).board), 1 /* TEXT */),\n                                        _cache[22] || (_cache[22] = _createElementVNode(\"span\", { class: \"bbs__sep\" }, \"/\", -1 /* CACHED */)),\n                                        _createElementVNode(\"span\", _hoisted_31, _toDisplayString(_unref(view).board) + \"帖子\" + _toDisplayString(_unref(view).postNo), 1 /* TEXT */)\n                                    ])\n                                ]),\n                                (_unref(thread))\n                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_32, [\n                                        _createElementVNode(\"div\", _hoisted_33, [\n                                            _createElementVNode(\"span\", _hoisted_34, _toDisplayString(_unref(thread).title), 1 /* TEXT */),\n                                            _createElementVNode(\"span\", _hoisted_35, \" No.\" + _toDisplayString(_unref(thread).postNo) + \" · \" + _toDisplayString(formatTime(_unref(thread).createdAtMs)) + \" · replies \" + _toDisplayString(_unref(thread).floors.length), 1 /* TEXT */)\n                                        ]),\n                                        (_unref(thread).body)\n                                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_36, _toDisplayString(_unref(thread).body), 1 /* TEXT */))\n                                            : _createCommentVNode(\"v-if\", true)\n                                    ]))\n                                    : _createCommentVNode(\"v-if\", true),\n                                (_unref(thread))\n                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_37, [\n                                        (_unref(thread).floors.length === 0)\n                                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_38, \"暂无回复\"))\n                                            : _createCommentVNode(\"v-if\", true),\n                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(thread).floors, (f) => {\n                                            return (_openBlock(), _createElementBlock(\"article\", {\n                                                key: f.floorNo,\n                                                class: \"bbs__reply\"\n                                            }, [\n                                                _createElementVNode(\"header\", _hoisted_39, [\n                                                    _createElementVNode(\"span\", _hoisted_40, \"No.\" + _toDisplayString(f.floorNo), 1 /* TEXT */),\n                                                    _createElementVNode(\"span\", _hoisted_41, _toDisplayString(formatTime(f.createdAtMs)), 1 /* TEXT */),\n                                                    _createElementVNode(\"button\", {\n                                                        class: \"bbs__replyBtn\",\n                                                        type: \"button\",\n                                                        onClick: ($event) => (beginReplyTo(f.floorNo))\n                                                    }, \"回复\", 8 /* PROPS */, _hoisted_42)\n                                                ]),\n                                                _createElementVNode(\"div\", _hoisted_43, _toDisplayString(f.content), 1 /* TEXT */)\n                                            ]));\n                                        }), 128 /* KEYED_FRAGMENT */))\n                                    ]))\n                                    : _createCommentVNode(\"v-if\", true),\n                                (_unref(thread))\n                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_44, [\n                                        _cache[26] || (_cache[26] = _createElementVNode(\"div\", { class: \"bbs__composerTitle\" }, \"Reply\", -1 /* CACHED */)),\n                                        (_unref(replyToFloorNo) !== null)\n                                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_45, [\n                                                _cache[23] || (_cache[23] = _createTextVNode(\" replying to \", -1 /* CACHED */)),\n                                                _createElementVNode(\"span\", _hoisted_46, \"No.\" + _toDisplayString(_unref(replyToFloorNo)), 1 /* TEXT */),\n                                                _createElementVNode(\"button\", {\n                                                    class: \"bbs__link\",\n                                                    type: \"button\",\n                                                    onClick: _cache[7] || (_cache[7] = ($event) => (clearReplyTo()))\n                                                }, \"取消引用\")\n                                            ]))\n                                            : _createCommentVNode(\"v-if\", true),\n                                        _createElementVNode(\"div\", _hoisted_47, [\n                                            _cache[24] || (_cache[24] = _createElementVNode(\"div\", { class: \"bbs__label\" }, \"你的回帖内容（将作为新楼层直接发布）\", -1 /* CACHED */)),\n                                            _withDirectives(_createElementVNode(\"textarea\", {\n                                                ref_key: \"replyTextareaEl\",\n                                                ref: replyTextareaEl,\n                                                \"onUpdate:modelValue\": _cache[8] || (_cache[8] = ($event) => (_isRef(replyText) ? (replyText).value = $event : null)),\n                                                class: \"bbs__textarea\",\n                                                rows: \"4\"\n                                            }, null, 512 /* NEED_PATCH */), [\n                                                [_vModelText, _unref(replyText)]\n                                            ])\n                                        ]),\n                                        _createElementVNode(\"div\", _hoisted_48, [\n                                            _cache[25] || (_cache[25] = _createElementVNode(\"div\", { class: \"bbs__label\" }, \"跟帖要求（可留空）\", -1 /* CACHED */)),\n                                            _withDirectives(_createElementVNode(\"textarea\", {\n                                                \"onUpdate:modelValue\": _cache[9] || (_cache[9] = ($event) => (_isRef(replyAiHint) ? (replyAiHint).value = $event : null)),\n                                                class: \"bbs__textarea\",\n                                                rows: \"3\"\n                                            }, null, 512 /* NEED_PATCH */), [\n                                                [_vModelText, _unref(replyAiHint)]\n                                            ])\n                                        ]),\n                                        _createElementVNode(\"div\", _hoisted_49, [\n                                            _createElementVNode(\"button\", {\n                                                class: \"bbs__btn bbs__btn--primary\",\n                                                type: \"button\",\n                                                onClick: _cache[10] || (_cache[10] = ($event) => (sendReplyAndLetAiFollow(_unref(thread))))\n                                            }, \" 回帖 \"),\n                                            _createElementVNode(\"button\", {\n                                                class: \"bbs__btn\",\n                                                type: \"button\",\n                                                onClick: _cache[11] || (_cache[11] = ($event) => (replyText.value = ''))\n                                            }, \"清空\")\n                                        ])\n                                    ]))\n                                    : _createCommentVNode(\"v-if\", true)\n                            ]))\n                            : (_unref(view).mode === 'newThread')\n                                ? (_openBlock(), _createElementBlock(\"section\", _hoisted_50, [\n                                    _createElementVNode(\"div\", _hoisted_51, [\n                                        _createElementVNode(\"button\", {\n                                            class: \"bbs__link\",\n                                            type: \"button\",\n                                            onClick: _cache[12] || (_cache[12] = ($event) => (view.value = { mode: 'board' }))\n                                        }, \"← 返回\"),\n                                        _createElementVNode(\"div\", _hoisted_52, [\n                                            _createElementVNode(\"span\", _hoisted_53, _toDisplayString(_unref(selectedBoard)), 1 /* TEXT */),\n                                            _cache[27] || (_cache[27] = _createElementVNode(\"span\", { class: \"bbs__sep\" }, \"/\", -1 /* CACHED */)),\n                                            _cache[28] || (_cache[28] = _createElementVNode(\"span\", null, \"发新串\", -1 /* CACHED */))\n                                        ])\n                                    ]),\n                                    _createElementVNode(\"div\", _hoisted_54, [\n                                        _cache[31] || (_cache[31] = _createElementVNode(\"div\", { class: \"bbs__composerTitle\" }, \"New Thread\", -1 /* CACHED */)),\n                                        _createElementVNode(\"div\", _hoisted_55, [\n                                            _cache[29] || (_cache[29] = _createElementVNode(\"div\", { class: \"bbs__label\" }, \"标题（Subject）\", -1 /* CACHED */)),\n                                            _withDirectives(_createElementVNode(\"input\", {\n                                                \"onUpdate:modelValue\": _cache[13] || (_cache[13] = ($event) => (_isRef(newThreadTitle) ? (newThreadTitle).value = $event : null)),\n                                                class: \"bbs__input\",\n                                                type: \"text\"\n                                            }, null, 512 /* NEED_PATCH */), [\n                                                [_vModelText, _unref(newThreadTitle)]\n                                            ])\n                                        ]),\n                                        _createElementVNode(\"div\", _hoisted_56, [\n                                            _cache[30] || (_cache[30] = _createElementVNode(\"div\", { class: \"bbs__label\" }, \"正文（OP）\", -1 /* CACHED */)),\n                                            _withDirectives(_createElementVNode(\"textarea\", {\n                                                \"onUpdate:modelValue\": _cache[14] || (_cache[14] = ($event) => (_isRef(newThreadBody) ? (newThreadBody).value = $event : null)),\n                                                class: \"bbs__textarea\",\n                                                rows: \"7\"\n                                            }, null, 512 /* NEED_PATCH */), [\n                                                [_vModelText, _unref(newThreadBody)]\n                                            ])\n                                        ]),\n                                        _createElementVNode(\"div\", _hoisted_57, [\n                                            _createElementVNode(\"button\", {\n                                                class: \"bbs__btn bbs__btn--primary\",\n                                                type: \"button\",\n                                                onClick: _cache[15] || (_cache[15] = ($event) => (sendNewThreadPrompt()))\n                                            }, \"发布\"),\n                                            _createElementVNode(\"button\", {\n                                                class: \"bbs__btn\",\n                                                type: \"button\",\n                                                onClick: _cache[16] || (_cache[16] = ($event) => (clearNewThread()))\n                                            }, \"清空\")\n                                        ])\n                                    ])\n                                ]))\n                                : _createCommentVNode(\"v-if\", true)\n                ]),\n                _cache[32] || (_cache[32] = _createElementVNode(\"footer\", { class: \"bbs__footer\" }, [\n                    _createElementVNode(\"span\", { class: \"bbs__mono\" }, \"storage: localStorage\"),\n                    _createElementVNode(\"span\", { class: \"bbs__sep\" }, \"·\"),\n                    _createElementVNode(\"span\", { class: \"bbs__mono\" }, \"scope: chat\")\n                ], -1 /* CACHED */))\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./App.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./App.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./App.vue?vue&type=style&index=0&id=594d1231&lang=scss&scoped=true\"\n\nimport exportComponent from \"../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_fcc8164c33ab268660e3819796c9f485/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-594d1231\"]])\n\nexport default __exports__","import App from './ui/App.vue';\nimport './index.scss';\nfunction init() {\n    createApp(App).mount('#app');\n}\n$(() => {\n    errorCatched(init)();\n});\n"],"names":["exports","sfc","props","target","__vccOpts","key","val","__webpack_module_cache__","Vue","BOARD_NAMES","safeNowMs","Date","now","getStorageKey","chatId","window","SillyTavern","getCurrentChatId","String","length","getChatScopedKey","isBoardName","value","includes","loadState","raw","localStorage","getItem","version","boards","posts","meta","parsed","text","JSON","parse","safeJsonParse","state","boardName","b","Array","isArray","filter","p","map","board","postNo","Number","isFinite","title","body","createdAtMs","updatedAtMs","floors","f","floorNo","content","source","originKey","undefined","originFloorTagNo","sort","a","last","lastParsedAssistantMessageId","getBoardPosts","getNextPostNo","reduce","m","Math","max","getNextFloorNo","post","appendFloor","floor","next","desired","full","push","escapeRegexLiteral","replace","normalizeContent","trim","parseTaggedBlocks","normalized","boardsPattern","join","outerRe","RegExp","blocks","matchAll","tag","groups","inner","tagMatch","match","no","parseInt","floorRe","fm","ftag","finner","n","floorTagNo","applyParsedBlocks","originMessageId","createdPosts","appendedFloors","forEach","bIdx","existed","some","patch","find","upsertPost","fIdx","x","escapeForTagContent","buildAiFollowupPrompt","args","start","lastFloorNo","end","block","truncated","opts","maxFloors","selected","slice","buildTaggedContextBlock","styleHint","aiStyleHint","from","_","i","Boolean","slashQuote","async","sendPromptToTavern","prompt","triggerSlash","createChatMessages","role","message","DEFAULT_PRESET","_hoisted_1","class","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_15","_hoisted_16","_hoisted_17","_hoisted_18","_hoisted_19","_hoisted_20","_hoisted_21","_hoisted_22","_hoisted_23","_hoisted_24","_hoisted_25","_hoisted_26","_hoisted_27","_hoisted_28","_hoisted_29","_hoisted_30","_hoisted_31","_hoisted_32","_hoisted_33","_hoisted_34","_hoisted_35","_hoisted_36","_hoisted_37","_hoisted_38","_hoisted_39","_hoisted_40","_hoisted_41","_hoisted_42","_hoisted_43","_hoisted_44","_hoisted_45","_hoisted_46","_hoisted_47","_hoisted_48","_hoisted_49","_hoisted_50","_hoisted_51","_hoisted_52","_hoisted_53","_hoisted_54","_hoisted_55","_hoisted_56","_hoisted_57","__name","setup","__props","selectedBoard","ref","view","mode","toolsOpen","syncStatus","computed","thread","postKey","saveTimer","scheduleSave","clearTimeout","setTimeout","setItem","stringify","saveState","parseThisFloorTags","messageId","getCurrentMessageId","msg","getChatMessages","formatTime","ms","d","getFullYear","getMonth","padStart","getDate","getHours","getMinutes","watch","deep","replyText","replyAiHint","replyToFloorNo","replyTextareaEl","newThreadTitle","newThreadBody","requestAiNewThread","instruction","userInstruction","buildNewPostPrompt","clearNewThread","exportJson","importJson","onMounted","added","idx","ensurePresetPostsExist","myId","eventOn","tavern_events","MESSAGE_UPDATED","MESSAGE_SWIPED","GENERATION_ENDED","parseAssistantMessage","CHAT_CHANGED","location","reload","_ctx","_cache","type","onClick","$event","rows","readonly","confirm","toastr","error","success","prefix","startsWith","nextTick","focus","ref_key","warning","aiFloorsToGenerate","__webpack_require__","moduleId","cachedModule","module","__webpack_modules__","init","createApp","App","mount","$","errorCatched"],"ignoreList":[],"sourceRoot":""}